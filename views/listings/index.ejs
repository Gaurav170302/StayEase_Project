<% layout("/layouts/boilerplate") %>

<body>
    <div class="container mt-4">
        <h2 class="mb-4">All Listings...</h2>

        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            <% for(let listing of allListing) { %>
                <div class="col">
                    <div class="card h-100">
                        <a href="/listings/<%= listing._id %>">
                            <img src="<%= listing.image %>" class="card-img-top" alt="Property Image" style="height: 20rem; object-fit: cover;">
                            <div class="card-img-overlay"></div>
                        </a>
                        <div class="card-body">
                            <h5 class="card-title"><%= listing.title %></h5>
                    
                            
                            <!-- The error in above commented P tag is:
                                But some of your listing.price values are undefined, which causes this error :-
                                "TypeError: Cannot read properties of null (reading 'toLocaleString')"

                                ✅ Optional: Add default price while rendering (controller)
                                        If you want to avoid changing the EJS, you can also do this in your controller before rendering:
                                        In routes/listings.js or app.js (wherever you render):

                                        listings.forEach(listing => {
                                            if (typeof listing.price !== "number") {
                                                listing.price = 0; // or any default value
                                            }
                                        });
                            -->

                            <!-- <p class="card-text">
                                ₹<%= listing.price ? listing.price.toLocaleString("en-IN") : "N/A" %> / night
                            </p> -->


                            <!-- If listing.price is a number
                            If not, it shows "Price not available" instead of crashing -->
                            <p class="card-text">
                                <% if (typeof listing.price === 'number') { %>
                                    ₹ <%= listing.price.toLocaleString("en-IN") %> / night
                                <% } else { %>
                                    Price not available
                                <% } %>
                            </p>

                        </div>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
    
    
    <!-- <h2>All Listings...</h2> -->

    <!-- <form method="GET"  action="/listings/new">
        <button>Add New Listing</button>
    </form> -->

    <!-- <% for(let listing of allListing) { %>
    <a href="/listings/<%= listing._id %>">
        <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1">
                <div class="card">
                    <img src="<%= listing.image %>" class="card-img-top" alt="Property_Image" style="height: 20rem;">
                    <div class="card-body">
                      <p class="card-text card-price">
                        <b><%= listing.title %></b> <br>
                        &#8377; <%= listing.price.toLocaleString("en-IN") %> / night
                      </p>
                    </div>
                </div>
        </div>
    </a>
    <% } %> -->


    <!-- <div>
        <% for(let listing of allListing) { %>
            <ul>
                <li><a href="/listings/<%= listing._id %>"><%= listing.title %></a></li>
            </ul>
        <% } %>
    </div> -->
</body>









